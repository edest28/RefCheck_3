{% extends "base.html" %}
{% block title %}{{ company.name }} - RefCheck AI{% endblock %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
  <a href="{{ url_for('companies.list_companies') }}" style="color: var(--text-muted); font-size: 0.9rem;">← Back to Companies</a>
  <div style="display:flex; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-top: 0.5rem;">
    <div>
      <h1 style="font-size: 1.75rem; font-weight: 600; letter-spacing: -0.02em; margin-bottom: 0.25rem;">{{ company.name }}</h1>
      {% if company.website %}
        <p style="color: var(--text-secondary);">
          <a href="{{ company.website }}" target="_blank" style="color: var(--accent);">{{ company.website }}</a>
        </p>
      {% endif %}
      {% if company.description %}
        <p style="color: var(--text-secondary); margin-top: 0.5rem;">{{ company.description }}</p>
      {% endif %}
    </div>
    <div style="display:flex; gap: 0.75rem;">
      <a class="btn btn-secondary" href="{{ url_for('companies.edit_company', company_id=company.id) }}">Edit</a>
      <button class="btn btn-danger" onclick="deleteCompany('{{ company.id }}')">Delete</button>
      <a class="btn btn-primary" href="{{ url_for('jobs.new_job', company_id=company.id) }}">Create Job</a>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <span>Jobs</span>
    <span style="font-weight: 400; color: var(--text-muted); font-size: 0.85rem;">{{ jobs|length }} total</span>
  </div>
  <div class="card-body">
    {% if jobs|length == 0 %}
      <p style="color: var(--text-muted);">No jobs yet. Create your first job for this company.</p>
      <div class="mt-2">
        <a class="btn btn-primary" href="{{ url_for('jobs.new_job', company_id=company.id) }}">Create a job</a>
      </div>
    {% else %}
      <div style="display:flex; flex-direction: column; gap: 0.75rem;">
        {% for job in jobs %}
          <a class="card" href="{{ url_for('jobs.view_job', job_id=job.id) }}" style="text-decoration:none;">
            <div class="card-body" style="padding: 1.25rem 1.5rem; display:flex; justify-content: space-between; align-items: center; gap: 1rem;">
              <div style="min-width: 0;">
                <div style="font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                  {{ job.title }}
                </div>
                <div style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.125rem;">
                  {{ job.department or '—' }} • {{ job.location or '—' }} • {{ job.employment_type or '—' }}
                </div>
              </div>
              <div style="display:flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
                {% set status = job.status or 'draft' %}
                <span class="status-badge {{ status }}" style="background: var(--bg-tertiary); color: var(--text-muted);">
                  {{ status|capitalize }}
                </span>
                <span style="color: var(--text-muted); font-size: 0.85rem;">
                  {% set count = job.applicant_count|default(0) %}
                  {{ count }} {{ 'applicant' if count == 1 else 'applicants' }}
                </span>
                <span style="color: var(--text-muted); font-size: 0.85rem;">
                  Updated {{ job.updated_at.strftime('%b %d') if job.updated_at else '' }}
                </span>
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function deleteCompany(companyId) {
  if (!confirm('Are you sure you want to delete this company? This action cannot be undone. All jobs under this company will also be deleted.')) {
    return;
  }
  
  fetch(`/companies/${companyId}`, {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
    credentials: 'same-origin'
  })
  .then(resp => resp.json())
  .then(data => {
    if (data.error) {
      alert('Error: ' + data.error);
    } else {
      window.location.href = '/companies';
    }
  })
  .catch(err => {
    alert('Error: ' + err.message);
  });
}
</script>
{% endblock %}
